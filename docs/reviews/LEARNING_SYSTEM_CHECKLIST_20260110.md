# Implementation Phase Checklist
## Learning System Bug Fix & Data Consistency

**Base Document**: LEARNING_SYSTEM_REVIEW_20260110.md
**Created**: 2026-01-10
**Target Branch**: `claude/review-learning-logic-NSsWS`

---

## Pre-Implementation Verification

- [ ] Review ë¬¸ì„œ í™•ì • ì„ ì–¸ ì™„ë£Œ
- [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ì—¬ í˜„ì¬ ìƒíƒœ ê¸°ë¡
- [ ] ì‘ì—… ë¸Œëœì¹˜ ìƒì„± ë° ì²´í¬ì•„ì›ƒ ì™„ë£Œ
- [ ] ê´€ë ¨ íŒŒì¼ ë°±ì—… ì™„ë£Œ (ë˜ëŠ” git stash)

---

## Feature 1: í”¼ë“œë°± ì‹œìŠ¤í…œ ë°ì´í„° ì¼ê´€ì„± ìˆ˜ì •

### Story 1.1: get_recent_feedback() SQL ì¿¼ë¦¬ ìˆ˜ì •

#### Task 1.1.1: SQL ì»¬ëŸ¼ëª… ìˆ˜ì •
- [ ] `feedback_system.py:606-614` SELECT ì ˆ ìˆ˜ì •
  - [ ] `predicted_value` â†’ `predicted_probability`
  - [ ] `actual_value` â†’ `actual_return_7d`
  - [ ] `prediction_type` ì œê±°
- [ ] ì½”ë“œ ìˆ˜ì • í›„ ë¬¸ë²• ì˜¤ë¥˜ ì—†ìŒ í™•ì¸

#### Task 1.1.2: ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ í‚¤ ì¼ì¹˜
- [ ] ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ê°€ DB ì»¬ëŸ¼ëª…ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- [ ] `sqlite3.Row` â†’ `dict` ë³€í™˜ ì‹œ í‚¤ ë§¤í•‘ í™•ì¸

#### Task 1.1.3: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] `tests/learning/test_feedback_system.py` í…ŒìŠ¤íŠ¸ íŒŒì¼ í™•ì¸/ìƒì„±
- [ ] `test_get_recent_feedback_returns_correct_columns()` í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

**Story 1.1 ì™„ë£Œ ê¸°ì¤€**:
- [ ] `get_recent_feedback()` í˜¸ì¶œ ì‹œ SQL ì˜¤ë¥˜ ì—†ìŒ
- [ ] ë°˜í™˜ ë°ì´í„°ì— `predicted_probability`, `actual_return_7d` í‚¤ ì¡´ì¬
- [ ] í…ŒìŠ¤íŠ¸ í†µê³¼

---

### Story 1.2: factor_scores ì €ì¥/ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€

#### Task 1.2.1: DB ìŠ¤í‚¤ë§ˆ ë³€ê²½
- [ ] `feedback_system.py:91-108` í…Œì´ë¸” ìƒì„±ë¬¸ì— `factor_scores TEXT` ì¶”ê°€
- [ ] ê¸°ì¡´ DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë°©ì•ˆ ê²°ì • (ALTER TABLE vs ì¬ìƒì„±)
- [ ] ì¸ë±ìŠ¤ í•„ìš” ì—¬ë¶€ ê²€í†  (í˜„ì¬: ë¶ˆí•„ìš”)

#### Task 1.2.2: factor_scores ì €ì¥ ë¡œì§
- [ ] `record_predictions()`ì— factor_scores íŒŒë¼ë¯¸í„° ì¶”ê°€
- [ ] JSON ì§ë ¬í™” ë¡œì§ êµ¬í˜„ (`json.dumps()`)
- [ ] INSERT ë¬¸ì— factor_scores ì»¬ëŸ¼ ì¶”ê°€

#### Task 1.2.3: factor_scores ì¡°íšŒ ë¡œì§
- [ ] `get_recent_feedback()` SELECT ì ˆì— `factor_scores` ì¶”ê°€
- [ ] JSON ì—­ì§ë ¬í™” ë¡œì§ êµ¬í˜„ (`json.loads()`)
- [ ] NULL ê°’ ì²˜ë¦¬ (ê¸°ì¡´ ë°ì´í„° í˜¸í™˜)

#### Task 1.2.4: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
- [ ] `scripts/migrate_feedback_db.py` ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [ ] ALTER TABLE ëª…ë ¹ í¬í•¨
- [ ] ë¡¤ë°± ë°©ì•ˆ ë¬¸ì„œí™”

**Story 1.2 ì™„ë£Œ ê¸°ì¤€**:
- [ ] ìƒˆ ì˜ˆì¸¡ ì €ì¥ ì‹œ factor_scores ì •ìƒ ì €ì¥
- [ ] ì¡°íšŒ ì‹œ factor_scores ë”•ì…”ë„ˆë¦¬ë¡œ ë°˜í™˜
- [ ] ê¸°ì¡´ ë°ì´í„° ì¡°íšŒ ì‹œ `{}` ë˜ëŠ” `None` ë°˜í™˜ (ì˜¤ë¥˜ ì—†ìŒ)

---

## Feature 2: ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° íŒŒë¼ë¯¸í„° ì „ë‹¬ ìˆ˜ì •

### Story 2.1: í”¼ë“œë°± ë°ì´í„° ì ‘ê·¼ ë°©ì‹ ìˆ˜ì •

#### Task 2.1.1: ë”•ì…”ë„ˆë¦¬ í‚¤ ì ‘ê·¼ ë³€ê²½
- [ ] `learning_orchestrator.py:281-287` ìˆ˜ì •
  - [ ] `fb.stock_code` â†’ `fb['stock_code']`
  - [ ] `fb.actual_return` â†’ `fb.get('actual_return_7d', 0)`

#### Task 2.1.2: í‚¤ ì´ë¦„ ìˆ˜ì •
- [ ] `actual_return` â†’ `actual_return_7d` ë§¤í•‘ í™•ì¸
- [ ] `pnl_ratio` ê³„ì‚° ë¡œì§ ìˆ˜ì • (í•„ìš”ì‹œ)

#### Task 2.1.3: factor_scores ê¸°ë³¸ê°’ ì²˜ë¦¬
- [ ] `fb.get('factor_scores', {})` íŒ¨í„´ ì ìš©
- [ ] None ì²˜ë¦¬ ì¶”ê°€ (`or {}`)

**Story 2.1 ì™„ë£Œ ê¸°ì¤€**:
- [ ] `_run_weight_update_check()` í˜¸ì¶œ ì‹œ AttributeError ì—†ìŒ
- [ ] KeyError ì—†ìŒ
- [ ] ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ ì •ìƒ ë™ì‘

---

### Story 2.2: model_performance ë°˜í™˜ê°’ ë³´ì™„

#### Task 2.2.1: win_rate ë°˜í™˜ ì¶”ê°€
- [ ] `learning_orchestrator.py:333-346` ìˆ˜ì •
- [ ] RetrainHistoryì—ì„œ win_rate ì¡°íšŒ ë©”ì„œë“œ í™•ì¸
- [ ] ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ì— `'win_rate'` í‚¤ ì¶”ê°€

#### Task 2.2.2: sharpe_ratio ë°˜í™˜ ì¶”ê°€
- [ ] sharpe_ratio ê³„ì‚° ë¡œì§ êµ¬í˜„
  - [ ] ì¼ë³„ ìˆ˜ìµë¥  ë°ì´í„° ìˆ˜ì§‘
  - [ ] (í‰ê·  ìˆ˜ìµë¥  / í‘œì¤€í¸ì°¨) * sqrt(252) ê³„ì‚°
- [ ] ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ì— `'sharpe_ratio'` í‚¤ ì¶”ê°€
- [ ] ë°ì´í„° ë¶€ì¡± ì‹œ ê¸°ë³¸ê°’ ì²˜ë¦¬ (0.0 ë˜ëŠ” 1.0)

#### Task 2.2.3: RetrainTrigger ì—°ë™ í…ŒìŠ¤íŠ¸
- [ ] `tests/learning/test_retrain_trigger.py` í…ŒìŠ¤íŠ¸ í™•ì¸/ìƒì„±
- [ ] `test_trigger_with_complete_model_performance()` ì‘ì„±
- [ ] win_rate < 0.45 ì¡°ê±´ í…ŒìŠ¤íŠ¸
- [ ] sharpe_ratio < 0.5 ì¡°ê±´ í…ŒìŠ¤íŠ¸

**Story 2.2 ì™„ë£Œ ê¸°ì¤€**:
- [ ] `_get_model_performance()` ë°˜í™˜ê°’ì— `win_rate`, `sharpe_ratio` í¬í•¨
- [ ] RetrainTriggerê°€ í•´ë‹¹ ê°’ìœ¼ë¡œ ì¡°ê±´ ì²´í¬ ìˆ˜í–‰
- [ ] í…ŒìŠ¤íŠ¸ í†µê³¼

---

## Feature 3: ìŠ¤ì¼€ì¤„ ìˆœì„œ ìµœì í™”

### Story 3.1: ê¸ˆìš”ì¼ ìŠ¤ì¼€ì¤„ ìˆœì„œ ì¡°ì •

#### Task 3.1.1: ë°±í…ŒìŠ¤íŠ¸ ì‹œê°„ ë³€ê²½
- [ ] `integrated_scheduler.py` ê²€ìƒ‰: "friday" ë˜ëŠ” "20:00"
- [ ] `_run_weekly_backtest` ìŠ¤ì¼€ì¤„ì„ 16:00ìœ¼ë¡œ ë³€ê²½
- [ ] ìŠ¤ì¼€ì¤„ ìˆœì„œ í™•ì¸: 16:00 ë°±í…ŒìŠ¤íŠ¸ â†’ 17:00 ê°€ì¤‘ì¹˜ ì¡°ì •

#### Task 3.1.2: ì˜ì¡´ì„± ì£¼ì„ ì¶”ê°€
- [ ] ìŠ¤ì¼€ì¤„ ë“±ë¡ ë¶€ë¶„ì— ì˜ì¡´ì„± ê´€ê³„ ì£¼ì„ ì¶”ê°€
- [ ] ì˜ˆ: `# Note: ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” 17:00 ê°€ì¤‘ì¹˜ ì¡°ì •ì— ë°˜ì˜ë¨`

**Story 3.1 ì™„ë£Œ ê¸°ì¤€**:
- [ ] ê¸ˆìš”ì¼ ìŠ¤ì¼€ì¤„: 16:00 ë°±í…ŒìŠ¤íŠ¸ â†’ 17:00 ê°€ì¤‘ì¹˜ ì¡°ì •
- [ ] ì½”ë“œ ì£¼ì„ìœ¼ë¡œ ì˜ì¡´ì„± ëª…ì‹œ

---

## Feature 4: ëª¨ë¸ ì¬í•™ìŠµ ë°ì´í„° í˜•ì‹ í†µì¼

### Story 4.1: í•™ìŠµ ë°ì´í„° ë³€í™˜ ê³„ì¸µ ì¶”ê°€

#### Task 4.1.1: ë³€í™˜ í•¨ìˆ˜ ì¶”ê°€
- [ ] `learning_orchestrator.py`ì— `_convert_feedback_to_training_data()` í•¨ìˆ˜ ì¶”ê°€
- [ ] ì…ë ¥: `List[Dict]` (get_recent_feedback ê²°ê³¼)
- [ ] ì¶œë ¥: `List[Dict]` (ModelRetrainer ê¸°ëŒ€ í˜•ì‹)

#### Task 4.1.2: í•„ë“œ ë§¤í•‘ êµ¬í˜„
- [ ] ë§¤í•‘ ê·œì¹™:
  - [ ] `predicted_probability` â†’ `predicted_probability`
  - [ ] `predicted_class` â†’ `predicted_class`
  - [ ] `actual_class` â†’ `actual_class`
  - [ ] `actual_return_7d` â†’ `actual_return`
- [ ] `is_win` í•„ë“œ ê³„ì‚° ì¶”ê°€ (`actual_class == 1`)

#### Task 4.1.3: ì…ë ¥ ê²€ì¦ ë¡œì§
- [ ] ModelRetrainerì— ì…ë ¥ ê²€ì¦ ì¶”ê°€ (ì„ íƒì )
- [ ] í•„ìˆ˜ í‚¤ ì¡´ì¬ í™•ì¸
- [ ] ë°ì´í„° íƒ€ì… ê²€ì¦

**Story 4.1 ì™„ë£Œ ê¸°ì¤€**:
- [ ] `_execute_model_retrain()`ì´ ë³€í™˜ í•¨ìˆ˜ ì‚¬ìš©
- [ ] ModelRetrainerê°€ ì •ìƒì ìœ¼ë¡œ í•™ìŠµ ë°ì´í„° ìˆ˜ì‹ 
- [ ] ì¬í•™ìŠµ ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ ì—†ìŒ

---

## Integration Test

### ì „ì²´ í•™ìŠµ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸

- [ ] í”¼ë“œë°± ì €ì¥ â†’ ì¡°íšŒ â†’ ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ íë¦„ í…ŒìŠ¤íŠ¸
- [ ] í”¼ë“œë°± ì €ì¥ â†’ ì¡°íšŒ â†’ ì¬í•™ìŠµ íŠ¸ë¦¬ê±° â†’ ì¬í•™ìŠµ ì‹¤í–‰ íë¦„ í…ŒìŠ¤íŠ¸
- [ ] ë ˆì§ íƒì§€ â†’ ì „ëµ ë§¤í¼ â†’ ê°€ì¤‘ì¹˜ ì ìš© íë¦„ í…ŒìŠ¤íŠ¸

### ìŠ¤ì¼€ì¤„ í†µí•© í…ŒìŠ¤íŠ¸

- [ ] `run_daily_cycle()` ì „ì²´ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
- [ ] ê° ìŠ¤í… ê²°ê³¼ ê²€ì¦
- [ ] ì˜¤ë¥˜ ë°œìƒ ì‹œ ì ì ˆí•œ ë¡œê¹… í™•ì¸

---

## Security Design Verification

- [ ] SQL ì¿¼ë¦¬ì— íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì‚¬ìš© í™•ì¸ (SQL Injection ë°©ì§€)
- [ ] JSON ì§ë ¬í™”/ì—­ì§ë ¬í™” ì‹œ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ë°ì´í„° ì²˜ë¦¬ ì—†ìŒ í™•ì¸
- [ ] ë¡œê·¸ì— ë¯¼ê° ì •ë³´ ë…¸ì¶œ ì—†ìŒ í™•ì¸

---

## Performance Verification

- [ ] factor_scores JSON ì§ë ¬í™” ì„±ëŠ¥ ì˜í–¥ ë¯¸ë¯¸í•¨ í™•ì¸
- [ ] sharpe_ratio ê³„ì‚° ì„±ëŠ¥ ì˜í–¥ ë¯¸ë¯¸í•¨ í™•ì¸
- [ ] DB ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë³€ê²½ ì—†ìŒ í™•ì¸ (EXPLAIN ì‚¬ìš©)

---

## Code Quality

- [ ] ëª¨ë“  except ë¸”ë¡ì— `exc_info=True` í¬í•¨
- [ ] ìƒˆ í•¨ìˆ˜ì— docstring ì‘ì„±
- [ ] íƒ€ì… íŒíŠ¸ ì¶”ê°€ (Optional, Dict, List ë“±)
- [ ] ë¶ˆí•„ìš”í•œ ì½”ë“œ/ì£¼ì„ ì œê±°

---

## Documentation Update

- [ ] ë³€ê²½ëœ í•¨ìˆ˜ docstring ì—…ë°ì´íŠ¸
- [ ] DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¬¸ì„œí™” (í•„ìš”ì‹œ)
- [ ] CLAUDE.md ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€ ê²€í† 

---

## Git & PR

### Commit Checklist
- [ ] ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ì»¤ë°‹ ë¶„ë¦¬
  - [ ] Commit 1: SQL ì»¬ëŸ¼ëª… ìˆ˜ì • (Bug Fix)
  - [ ] Commit 2: factor_scores ê¸°ëŠ¥ ì¶”ê°€ (Feature)
  - [ ] Commit 3: ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° íŒŒë¼ë¯¸í„° ìˆ˜ì • (Bug Fix)
  - [ ] Commit 4: ìŠ¤ì¼€ì¤„ ìˆœì„œ ìµœì í™” (Enhancement)
  - [ ] Commit 5: í…ŒìŠ¤íŠ¸ ì¶”ê°€ (Test)
- [ ] ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜ ì¤€ìˆ˜
- [ ] ê° ì»¤ë°‹ í›„ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### PR Checklist
- [ ] PR ì œëª©: `ğŸ”§ Fix learning system data flow and parameter passing`
- [ ] PR ë³¸ë¬¸ì— ë³€ê²½ ì‚¬í•­ ìš”ì•½ í¬í•¨
- [ ] ê´€ë ¨ ì´ìŠˆ ë§í¬ (ìˆëŠ” ê²½ìš°)
- [ ] í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìŠ¤í¬ë¦°ìƒ·/ë¡œê·¸ ì²¨ë¶€
- [ ] ë¦¬ë·°ì–´ ì§€ì •

---

## Post-Implementation Verification

- [ ] ì „ì²´ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ í†µê³¼
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ dry-run í…ŒìŠ¤íŠ¸ (ì‹¤ì œ í•™ìŠµ ì—†ì´ íŒŒì´í”„ë¼ì¸ íë¦„ í™•ì¸)
- [ ] ë¡œê·¸ ë ˆë²¨ë³„ ì¶œë ¥ í™•ì¸
- [ ] ê¸°ì¡´ ê¸°ëŠ¥ íšŒê·€ ì—†ìŒ í™•ì¸

---

## Final Sign-off

| í•­ëª© | ë‹´ë‹¹ | ì™„ë£Œ |
|------|------|------|
| Feature 1 êµ¬í˜„ ì™„ë£Œ | - | [ ] |
| Feature 2 êµ¬í˜„ ì™„ë£Œ | - | [ ] |
| Feature 3 êµ¬í˜„ ì™„ë£Œ | - | [ ] |
| Feature 4 êµ¬í˜„ ì™„ë£Œ | - | [ ] |
| Integration Test í†µê³¼ | - | [ ] |
| Security ê²€ì¦ ì™„ë£Œ | - | [ ] |
| Performance ê²€ì¦ ì™„ë£Œ | - | [ ] |
| ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ | - | [ ] |
| PR ìƒì„± ë° ë¨¸ì§€ ì™„ë£Œ | - | [ ] |

---

## Notes

### ì˜ì¡´ì„± ê·¸ë˜í”„

```
1.1.1 â†’ 1.1.2 â†’ 2.1.1 â†’ 2.1.2
              â†˜       â†˜
               1.1.3   4.1.1 â†’ 4.1.2 â†’ 4.1.3

1.2.1 â†’ 1.2.2 â†’ 1.2.3 â†’ 2.1.3
              â†˜
               1.2.4

2.2.1 â†’ 2.2.2 â†’ 2.2.3

3.1.1 â†’ 3.1.2
```

### ìœ„í—˜ ìš”ì†Œ

1. **DB ë§ˆì´ê·¸ë ˆì´ì…˜**: ìš´ì˜ ì¤‘ì¸ DBì— ALTER TABLE ì‹¤í–‰ ì‹œ ë½ ë°œìƒ ê°€ëŠ¥
   - ê¶Œì¥: íŠ¸ë˜í”½ ì ì€ ì‹œê°„ëŒ€ (ìƒˆë²½) ì‹¤í–‰

2. **ê¸°ì¡´ í”¼ë“œë°± ë°ì´í„°**: factor_scoresê°€ NULLì¸ ê¸°ì¡´ ë°ì´í„° ì²˜ë¦¬ í•„ìš”
   - ì¡°íšŒ ì‹œ `json.loads(fb.get('factor_scores') or '{}')` íŒ¨í„´ ì‚¬ìš©

3. **sharpe_ratio ê³„ì‚°**: ìˆ˜ìµë¥  ë°ì´í„° ë¶€ì¡± ì‹œ 0 ë‚˜ëˆ—ì…ˆ ê°€ëŠ¥
   - í‘œì¤€í¸ì°¨ê°€ 0ì¸ ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜ ì²˜ë¦¬ í•„ìˆ˜
