# 예측 정확도 개선 프로젝트

## 📊 문제 인식

**초기 상황**: 예측 승률 40% (손실 확률 60%)
- 확률적으로 지속 불가능한 수준
- 수수료 고려 시 순손실 발생 가능성 높음
- 주요 원인: 역추세 전략 과의존, 느슨한 필터링

---

## 🎯 개선 전략 (3단계)

### **방안 A: 보수적 접근 (즉시 적용)** ✅

**목표**: 리스크 최소화, 승률 60%+ 달성

#### 1. 선정 기준 강화 (`selection_criteria.py`)
```python
# 기존 → 보수적
price_attractiveness: 75→80 (상위 20%만)
technical_score: 60→70 (기술적 우위 필수)
risk_score: 35→25 (더 낮은 리스크)
confidence: 0.65→0.75 (높은 신뢰도)
max_position_size: 12%→8% (작은 포지션)
min_momentum_score: 60→70 (강한 모멘텀)
```

#### 2. 매매 설정 최적화 (`trading_engine.py`)
```python
# 기존 → 보수적
position_size: 10%→5% (50% 감소)
stop_loss: 5%→3% (빠른 손절)
take_profit: 10%→8% (현실적 익절)
max_trades_per_day: 20→15
risk_per_trade: 2%→1.5%
```

#### 3. 추세 추종 전략 추가 (`trend_follower.py`)
- **이동평균 정배열** 확인 (close > MA5 > MA20 > MA60)
- **추세 강도** 계산 (ADX 대용)
- **모멘텀 점수** (ROC 기반)
- 최소 5일 추세 지속 필수
- 역추세 전략 보완

**예상 효과**:
- 승률 40% → 60%+
- 최대 손실 50% 감소
- 안정적 수익 구조

---

### **방안 B: 백테스트 시스템 (중기)** ✅

**목표**: 데이터 기반 전략 검증 및 최적화

#### 1. 백테스트 엔진 (`strategy_backtester.py`)
```python
class StrategyBacktester:
    - 과거 데이터 로드 및 시뮬레이션
    - 손절/익절/기간 청산 로직
    - 성과 분석 (승률, 샤프비율 등)
```

#### 2. 성과 지표
- **승률** (Win Rate)
- **평균 수익률** / 승리 / 손실
- **총 수익률**
- **최대 낙폭** (Max Drawdown)
- **Sharpe Ratio**
- **Profit Factor** (총이익/총손실)
- **평균 보유 기간**

#### 3. 전략 비교 시스템
```bash
python tests/test_backtest_strategies.py
```
- 보수적 vs 공격적 전략 비교
- 최적 파라미터 탐색
- 섹터별/시가총액별 성과 분석

**활용 방법**:
1. 실제 데이터로 과거 30-60일 백테스트
2. 승률 높은 패턴/조건 추출
3. 파라미터 최적화 (손절/익절 비율)
4. 주기적 재검증 (월 1회)

---

### **방안 C: 멀티 전략 시스템 (장기)** ✅

**목표**: 시장 적응형 앙상블, 안정적 수익

#### 1. 3가지 전략 포트폴리오

##### 📈 추세 추종 (Trend Following)
```
최적 환경: 상승장
기준: price 80+, tech 70+, risk <25
손절/익절: 3% / 8%
보유: 최대 10일
```

##### 🔄 평균 회귀 (Mean Reversion)
```
최적 환경: 횡보장
기준: price 75+, tech 65+, risk <30
손절/익절: 4% / 6%
보유: 최대 5일 (단기)
```

##### 🚀 모멘텀 (Momentum)
```
최적 환경: 변동성 높은 상승장
기준: price 85+, tech 75+, risk <30
손절/익절: 4% / 12%
보유: 최대 15일
```

#### 2. 시장 체제 자동 감지 (6가지)

| 체제 | 판단 기준 | 최적 전략 |
|------|-----------|-----------|
| 상승 추세 (안정) | MA20 > MA60, 낮은 변동성 | 추세 추종 (60%) |
| 상승 추세 (변동) | MA20 > MA60, 높은 변동성 | 모멘텀 (50%) |
| 하락 추세 (안정) | MA20 < MA60, 낮은 변동성 | 현금 보유 |
| 하락 추세 (변동) | MA20 < MA60, 높은 변동성 | 현금 보유 |
| 횡보 (안정) | 추세 없음, 낮은 변동성 | 평균 회귀 (60%) |
| 횡보 (변동) | 추세 없음, 높은 변동성 | 평균 회귀 (40%) |

#### 3. 앙상블 선정 시스템
```python
manager = get_multi_strategy_manager()

# 1. 시장 체제 감지
regime = manager.detect_market_regime(kospi_data)

# 2. 최적 전략 선택
strategy = manager.select_strategy(kospi_data)

# 3. 앙상블 선정 (여러 전략 조합)
selected = manager.get_ensemble_stocks(candidates, kospi_data, max_stocks=10)
```

**앙상블 평가**:
- 각 전략별로 종목 점수 계산
- 시장 체제별 가중치 적용
- 종합 점수로 최종 선정
- 리스크 분산 효과

---

## 📈 예상 성과 개선

### 단계별 목표

| 단계 | 방안 | 목표 승률 | 예상 수익률 | 리스크 |
|------|------|-----------|-------------|--------|
| 초기 | 기존 전략 | 40% | -5% ~ +5% | 높음 |
| **1단계** | 방안 A | **60%+** | +8% ~ +15% | 중간 |
| **2단계** | A + B | **65%+** | +12% ~ +20% | 중간 |
| **3단계** | A + B + C | **70%+** | +15% ~ +25% | 낮음 |

### 리스크 관리 개선

| 지표 | 기존 | 개선 후 |
|------|------|---------|
| 최대 낙폭 | -15% | **-8%** |
| 평균 손실 | -6% | **-3%** |
| 포지션 크기 | 10% | **5%** |
| 손절 속도 | 5% 하락 | **3% 하락** |

---

## 🚀 즉시 실행 가능한 액션

### 1. 시스템 적용 (자동)
```bash
# 보수적 설정 이미 적용됨
git pull  # 최신 코드 업데이트

# 다음 거래일부터 자동 적용
# - 엄격한 선정 기준
# - 작은 포지션 (5%)
# - 빠른 손절 (3%)
```

### 2. 백테스트 실행 (수동)
```bash
# 과거 30일 전략 검증
python tests/test_backtest_strategies.py

# 결과 확인
cat data/backtesting/backtest_YYYYMMDD_HHMMSS.json
```

### 3. 모니터링
```bash
# 실시간 승률 확인
cat data/trades/trade_summary_$(date +%Y%m%d).json | grep win_rate

# 일일 성과 확인
tail -f logs/$(date +%Y%m%d).log | grep "수익률\|승률"
```

---

## 📊 성과 추적

### 주간 리뷰 (매주 금요일)
- [ ] 이번 주 승률 확인
- [ ] 최대 손실 종목 분석
- [ ] 최고 수익 종목 패턴 학습
- [ ] 백테스트 재실행

### 월간 최적화 (매월 1일)
- [ ] 월간 승률 60% 이상 유지 확인
- [ ] 손절/익절 비율 조정 검토
- [ ] 새로운 패턴 발견 및 적용
- [ ] ML 자동 트리거 조건 확인

---

## 🎓 학습 및 개선 사이클

### 1-2주 후 (방안 A 검증)
```
실제 매매 데이터 30건+ 수집
→ 백테스트로 검증
→ 승률 60%+ 달성 여부 확인
→ 미달 시 파라미터 조정
```

### 1개월 후 (방안 B 본격 활용)
```
충분한 데이터 축적 (100건+)
→ 섹터별 성과 분석
→ 시가총액별 성과 분석
→ 최적 보유 기간 도출
→ ML 기반 특성 중요도 분석
```

### 2개월 후 (방안 C 전환)
```
시장 체제별 성과 분석
→ 멀티 전략 앙상블 적용
→ 자동 전략 전환 테스트
→ 안정적 운영 체제 확립
```

---

## ⚠️ 주의사항

### 1. 보수적 접근 유지
- 급격한 수익 추구 금지
- 손실 제한 엄수 (계좌의 3% 이내)
- 의심스러운 종목은 건너뛰기

### 2. 과적합 방지
- 백테스트 결과만 맹신 금지
- 최소 30일 이상 실전 검증 필수
- 정기적 재검증 (월 1회)

### 3. 감정 배제
- 시스템 신뢰 (알고리즘 기반)
- 손절매 망설이지 않기
- 익절 타이밍 준수

---

## 📚 관련 문서

- [가상계좌 설정](VIRTUAL_ACCOUNT_SETUP.md)
- [알고리즘 업그레이드](ALGORITHM_UPGRADE_SUMMARY.md)
- [ML 자동 트리거](ML_AUTO_TRIGGER_SUMMARY.md)
- [프로젝트 요약](PROJECT_SUMMARY.md)

---

## 🆘 문제 발생 시

1. **승률이 여전히 낮음 (< 50%)**
   - 백테스트 재실행
   - 선정 기준 더 강화
   - 전략 전환 검토

2. **손실이 계속됨**
   - 손절 비율 낮추기 (3% → 2%)
   - 포지션 크기 줄이기 (5% → 3%)
   - 일시 중단 및 재검토

3. **시스템 오류**
   - 로그 확인: `logs/$(date +%Y%m%d).log`
   - GitHub Issues 등록
   - 안전 모드로 전환

---

**마지막 업데이트**: 2025-10-04
**버전**: 1.0.0
**다음 리뷰**: 2025-10-11 (1주일 후)
