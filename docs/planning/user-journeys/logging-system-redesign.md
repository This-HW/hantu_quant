# 로그 시스템 전면 개편 - 사용자 여정

## 1. 개요

### 목표

- 개발자/운영자가 로그를 쉽게 생성하고 확인할 수 있는 통합 로깅 시스템 구축
- 에러 추적성 강화 (DB 영구 보관 + 로컬 단기 보관)
- 운영 효율성 향상 (systemd 통합, 자동 정리)

### 사용자

- **개발자**: 새 모듈 개발, 디버깅, 에러 추적
- **운영자**: 서비스 모니터링, 에러 대응, 로그 분석

### 예상 흐름

```
개발자 → 로거 생성 → 로그 기록 → 에러 발생 → 로그 확인 → 문제 해결
운영자 → 서비스 모니터링 → 에러 감지 → Telegram 알림 → 로그 조회 → 조치
```

---

## 2. 사용자 여정 다이어그램

### 2.1 개발자 여정: 로그 생성 및 확인

```
[시작: 새 모듈 개발]
         │
         ▼
┌─────────────────────┐
│ 1. 로거 생성         │
│ logger = get_logger │
│ (__name__)          │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│ 2. 로그 기록         │
│ logger.info/error() │
└──────────┬──────────┘
           │
      ┌────┴────┐
      │ 분기점   │
      └────┬────┘
    ┌──────┴──────┬──────────┐
    ▼             ▼          ▼
[INFO/DEBUG]  [ERROR]    [CRITICAL]
    │             │          │
    ▼             ▼          ▼
logs/info/   logs/errors/ + DB + Telegram
텍스트       JSON         영구   알림
    │             │          │
    └─────────────┴──────────┘
           │
           ▼
┌─────────────────────┐
│ 3일 후 자동 삭제     │
│ (로컬 파일만)       │
└─────────────────────┘
```

### 2.2 개발자 여정: 에러 디버깅

```
[시작: 에러 발생 감지]
         │
         ▼
┌─────────────────────────┐
│ 1. 에러 정보 확인        │
│ - Telegram 알림 수신     │
│ - 에러 타입, 메시지 확인 │
└──────────┬──────────────┘
           │
           ▼
┌─────────────────────────┐
│ 2. 로컬 로그 확인        │
│ tail -f logs/errors/    │
│ error_YYYYMMDD.json     │
└──────────┬──────────────┘
           │
      ┌────┴────┐
      │ 충분?    │
      └────┬────┘
    ┌──────┴──────┐
    ▼             ▼
  [예]          [아니오]
    │             │
    ▼             ▼
[문제 해결]  ┌──────────────┐
    │        │ 3. DB 조회    │
    │        │ psql 또는     │
    │        │ CLI 명령어    │
    │        └──────┬────────┘
    │               │
    │               ▼
    │        ┌──────────────┐
    │        │ 4. trace_id  │
    │        │ 기반 추적     │
    │        └──────┬────────┘
    │               │
    │               ▼
    └───────────>[문제 해결]
```

### 2.3 운영자 여정: 모니터링 및 대응

```
[시작: 서비스 가동 중]
         │
         ▼
┌─────────────────────────┐
│ 1. 주기적 로그 확인      │
│ - journalctl -f         │
│ - tail logs/info/*.log  │
└──────────┬──────────────┘
           │
      ┌────┴────┐
      │ 에러?    │
      └────┬────┘
    ┌──────┴──────┐
    ▼             ▼
  [없음]        [발생]
    │             │
    │             ▼
    │      ┌──────────────────┐
    │      │ 2. Telegram 알림  │
    │      │ 자동 수신         │
    │      └──────┬───────────┘
    │             │
    │             ▼
    │      ┌──────────────────┐
    │      │ 3. 심각도 판단    │
    │      └──────┬───────────┘
    │        ┌────┴────┐
    │        │         │
    │        ▼         ▼
    │    [WARNING]  [CRITICAL]
    │        │         │
    │        │         ▼
    │        │    ┌──────────────┐
    │        │    │ 4. 즉시 대응  │
    │        │    │ - 로그 확인   │
    │        │    │ - 서비스 재시작│
    │        │    └──────┬────────┘
    │        │           │
    │        └───────────┘
    │                    │
    └────────────────────┘
                         │
                         ▼
                   [정상화 확인]
```

---

## 3. 로그 시스템 내부 상태 흐름

### 3.1 로그 생성 및 처리

```
┌─────────────────────────────────────────────────────────┐
│                   로그 생성 시                           │
└─────────────────────────────────────────────────────────┘

logger.debug/info/warning/error/critical(message)
         │
         ▼
┌─────────────────┐
│ 레벨 판단        │
└────────┬────────┘
    ┌────┴────┬──────────┬──────────┐
    ▼         ▼          ▼          ▼
[DEBUG]   [INFO]    [WARNING]   [ERROR/CRITICAL]
    │         │          │          │
    ▼         ▼          ▼          ▼
로컬 텍스트 로컬 텍스트 로컬 텍스트 ┌──────────────────┐
파일만     + stdout   + stdout   │ 에러 핸들러       │
    │         │          │        │ - 로컬 JSON      │
    │         │          │        │ - DB 큐 추가     │
    │         │          │        │ - stderr 출력    │
    │         │          │        └──────┬───────────┘
    │         │          │               │
    │         │          │          ┌────┴────┐
    │         │          │          │         │
    │         │          │          ▼         ▼
    │         │          │    [로컬 저장]  [DB 배치 큐]
    │         │          │    동기 처리    비동기 처리
    │         │          │          │         │
    │         │          │          ▼         ▼
    │         │          │    logs/errors/ 배치 큐
    │         │          │    error_       (10개 또는
    │         │          │    YYYYMMDD     5초마다
    │         │          │    .json        플러시)
    │         │          │          │         │
    │         │          │          │         ▼
    │         │          │          │    ┌─────────┐
    │         │          │          │    │ DB      │
    │         │          │          │    │ INSERT  │
    │         │          │          │    │ (영구)  │
    │         │          │          │    └─────────┘
    │         │          │          │
    └─────────┴──────────┴──────────┘
                 │
                 ▼
          ┌──────────────┐
          │ 3일 후        │
          │ 자동 삭제     │
          └──────────────┘
```

### 3.2 에러 로깅 상세 흐름

```
┌─────────────────────────────────────────────────────────┐
│                   에러 발생                              │
└─────────────────────────────────────────────────────────┘

try:
    ...
except Exception as e:
    logger.error(f"실패: {e}", exc_info=True)
         │
         ▼
┌─────────────────────────────────────────────┐
│ ErrorContext 수집                            │
│ - timestamp                                  │
│ - trace_id (자동 생성/전파)                   │
│ - level (ERROR/CRITICAL)                     │
│ - service (scheduler/api-server)             │
│ - module, function                           │
│ - message                                    │
│ - error_type (예외 클래스명)                  │
│ - stack_trace (traceback)                    │
│ - context (추가 정보)                         │
└──────────────────┬──────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────┐
│ JSON 포맷팅                                  │
│ {                                            │
│   "timestamp": "2026-02-01T12:34:56",       │
│   "trace_id": "abc12345",                   │
│   "level": "ERROR",                         │
│   "service": "scheduler",                   │
│   "module": "trading_engine",               │
│   "function": "execute_order",              │
│   "message": "주문 실행 실패",               │
│   "error_type": "APIException",             │
│   "stack_trace": "...",                     │
│   "context": {...}                          │
│ }                                            │
└──────────────────┬──────────────────────────┘
                   │
            ┌──────┴──────┬─────────────┐
            ▼             ▼             ▼
     ┌──────────┐  ┌──────────┐  ┌──────────┐
     │ 로컬 저장 │  │ DB 큐    │  │ Telegram │
     │ (동기)   │  │ (비동기) │  │ (선택)   │
     └────┬─────┘  └────┬─────┘  └────┬─────┘
          │             │             │
          ▼             ▼             ▼
    logs/errors/   배치 큐        Telegram
    error_YYYY     (10개 또는     Bot API
    MMDD.json      5초마다        (5분 쿨다운)
          │         플러시)            │
          │             │             │
          ▼             ▼             ▼
    3일 후 삭제   error_logs     📱 알림
                  테이블 INSERT   수신
                  (영구 보관)
```

### 3.3 systemd 통합 흐름

```
┌─────────────────────────────────────────────────────────┐
│              systemd 서비스 시작                         │
└─────────────────────────────────────────────────────────┘

systemctl start hantu-scheduler
         │
         ▼
┌─────────────────────────────────────────────┐
│ 환경 변수 설정                               │
│ StandardOutput=null                          │
│ StandardError=journal                        │
└──────────────────┬──────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────┐
│ 로거 초기화                                  │
│ - FileHandler → logs/info/*.log             │
│ - ErrorHandler → logs/errors/*.json + DB    │
│ - stderr는 journald로 자동 전달             │
└──────────────────┬──────────────────────────┘
                   │
            ┌──────┴──────┬──────────┐
            ▼             ▼          ▼
      [DEBUG/INFO]    [ERROR]    [stderr 출력]
            │             │          │
            ▼             ▼          ▼
      로컬 파일       로컬+DB    journalctl
      텍스트          JSON       -u hantu-*
            │             │          │
            │             │          ▼
            │             │    ┌──────────────┐
            │             │    │ systemd      │
            │             │    │ journal 저장 │
            │             │    └──────────────┘
            │             │
            └─────────────┘
                   │
                   ▼
         ┌──────────────────┐
         │ 운영자 확인       │
         │ - tail -f        │
         │ - journalctl -f  │
         └──────────────────┘
```

---

## 4. 상태 전이 다이어그램

### 4.1 로그 핸들러 상태

```
┌──────────────────────────────────────────────────────────┐
│                    핸들러 상태 전이                       │
└──────────────────────────────────────────────────────────┘

[초기화]
   │
   ├─> get_logger(__name__)
   │
   ▼
[READY] ───────────────────────────────────────┐
   │                                           │
   ├─> logger.info() ─> [로컬 파일 쓰기]       │
   │                           │               │
   │                           ▼               │
   │                    [Success/Fail]         │
   │                           │               │
   ├─> logger.error() ─> [멀티 핸들러]         │
   │                           │               │
   │                    ┌──────┴──────┐       │
   │                    ▼             ▼       │
   │              [로컬 JSON]    [DB 큐]      │
   │                    │             │       │
   │                    ▼             ▼       │
   │              [Success]   [큐 추가 성공]  │
   │                    │             │       │
   │                    │             ▼       │
   │                    │      [배치 처리 중] │
   │                    │             │       │
   │                    │       ┌─────┴─────┐ │
   │                    │       ▼           ▼ │
   │                    │  [DB 성공]  [DB 실패]│
   │                    │       │           │ │
   │                    │       │      [재시도]│
   │                    │       │           │ │
   │                    └───────┴───────────┘ │
   │                                           │
   └───────────────────────────────────────────┘
                      │
                      ▼
              [서비스 종료]
                      │
                      ▼
              [큐 플러시]
                      │
                      ▼
                  [종료]
```

### 4.2 에러 로그 라이프사이클

```
[에러 발생]
     │
     ▼
[생성] ─────────────────────────────────────┐
     │                                      │
     ├─> 로컬 파일 저장                     │
     │   (error_YYYYMMDD.json)              │
     │   TTL: 3일                           │
     │                                      │
     ├─> DB 저장                            │
     │   (error_logs 테이블)                │
     │   TTL: 무제한                        │
     │                                      │
     ├─> Telegram 알림                      │
     │   (선택, 5분 쿨다운)                 │
     │                                      │
     └──────────────────────────────────────┘
                      │
                      ▼
              [상태: UNRESOLVED]
                      │
                ┌─────┴─────┐
                ▼           ▼
          [3일 경과]   [관리자 확인]
                │           │
                ▼           ▼
        [로컬 파일    [mark_resolved()]
         자동 삭제]         │
                │           ▼
                │   [상태: RESOLVED]
                │   (DB에는 영구 보관)
                │           │
                └───────────┘
```

---

## 5. 에러 처리 전략

### 5.1 에러 유형별 처리

| 에러 유형            | 감지 방법             | 처리 방법                      | 상태      | Telegram      |
| -------------------- | --------------------- | ------------------------------ | --------- | ------------- |
| **로그 핸들러 오류** | Handler.handleError() | 폴백 핸들러(stderr) → journald | Degraded  | ❌            |
| **DB 연결 실패**     | \_get_db_connection() | 로컬 파일만 저장 + 재시도 큐   | Partial   | ✅ (CRITICAL) |
| **파일 쓰기 실패**   | OSError/IOError       | stderr 출력 + Telegram 알림    | Critical  | ✅ (CRITICAL) |
| **Telegram 실패**    | requests.exceptions   | 재시도 (5분 쿨다운)            | Warning   | ❌            |
| **디스크 공간 부족** | OSError: No space     | 로그 자동 정리 + Telegram 알림 | Emergency | ✅ (CRITICAL) |
| **JSON 직렬화 실패** | TypeError/ValueError  | repr() 폴백 + 경고 로그        | Warning   | ❌            |
| **배치 큐 오버플로** | Queue.Full            | 즉시 플러시 + 큐 크기 확장     | Warning   | ❌            |

### 5.2 에러 복구 시나리오

#### 시나리오 1: DB 연결 실패

```
[에러 발생]
     │
     ▼
[DB 핸들러 실패]
     │
     ▼
[로컬 JSON 저장] ✅
     │
     ▼
[재시도 큐에 추가]
     │
     ├─> 30초 후 재시도
     │   │
     │   ▼
     │   [성공] → [DB INSERT] → [큐에서 제거]
     │   [실패] → [재시도 카운트 증가]
     │                │
     │                ▼
     │           [3회 실패 시]
     │                │
     │                ▼
     │        [Telegram 알림: DB 연결 불가]
     │                │
     │                ▼
     │           [큐에서 제거]
     │
     └─> [로컬 파일로만 보관]
```

#### 시나리오 2: 디스크 공간 부족

```
[파일 쓰기 시도]
     │
     ▼
[OSError: No space left]
     │
     ▼
[긴급 정리 시작]
     │
     ├─> 3일 이전 로그 삭제
     │   │
     │   ▼
     │   [공간 확보 확인]
     │   │
     │   ▼
     │   [성공] → [로그 쓰기 재시도]
     │   [실패] → [stderr로만 출력]
     │
     └─> [Telegram 알림: 디스크 부족]
         [운영자 수동 조치 필요]
```

#### 시나리오 3: 로그 핸들러 자체 오류

```
[로거 초기화 실패]
     │
     ▼
[폴백 핸들러 활성화]
     │
     ├─> stderr → journald
     │
     └─> Telegram 알림: 로깅 시스템 오류
         │
         ▼
     [기본 logging.basicConfig() 사용]
         │
         ▼
     [Degraded 모드로 운영]
     (기능 동작, 로깅만 제한적)
```

### 5.3 에러 수준별 알림 정책

| 로그 레벨    | 로컬 파일 | DB 저장 | Telegram        | 운영자 조치 |
| ------------ | --------- | ------- | --------------- | ----------- |
| **DEBUG**    | ✅ 텍스트 | ❌      | ❌              | 불필요      |
| **INFO**     | ✅ 텍스트 | ❌      | ❌              | 불필요      |
| **WARNING**  | ✅ 텍스트 | ❌      | ❌              | 모니터링    |
| **ERROR**    | ✅ JSON   | ✅      | ✅ (5분 쿨다운) | 확인 필요   |
| **CRITICAL** | ✅ JSON   | ✅      | ✅ (즉시)       | 즉시 대응   |

---

## 6. 마이그레이션 여정

### 6.1 전환 계획

```
[준비 단계]
     │
     ├─> 1. 기존 로그 백업
     │   - logs/ 전체 복사 → logs_backup_YYYYMMDD/
     │   - 중요 에러 로그 DB 수동 백업 (선택)
     │
     ├─> 2. 기존 로그 삭제
     │   - logs/*.log 삭제
     │   - logs/**/*.log 삭제
     │   - 디렉토리 구조만 유지
     │
     ├─> 3. 새 디렉토리 생성
     │   - logs/errors/
     │   - logs/info/
     │   - 권한 확인 (chmod 755)
     │
     └─> 4. DB 테이블 확인
         - error_logs 테이블 존재 확인
         - 스키마 버전 확인
         │
         ▼
[배포 단계]
     │
     ├─> 1. 코드 업데이트
     │   - git pull origin main
     │   - 의존성 확인 (requirements.txt)
     │
     ├─> 2. 서비스 재시작
     │   - systemctl restart hantu-scheduler
     │   - systemctl restart hantu-api
     │
     └─> 3. 초기 로그 생성 확인
         - logs/info/info_YYYYMMDD.log 생성 확인
         - logs/errors/ 비어있음 확인 (에러 없으면 정상)
         │
         ▼
[검증 단계]
     │
     ├─> 1. 로그 생성 확인
     │   - tail -f logs/info/info_YYYYMMDD.log
     │   - 시간, 레벨, 메시지 포맷 확인
     │
     ├─> 2. 에러 로그 테스트
     │   - 테스트 에러 발생시키기
     │   - logs/errors/error_YYYYMMDD.json 생성 확인
     │   - psql로 error_logs 테이블 확인
     │
     ├─> 3. Telegram 알림 확인
     │   - CRITICAL 에러 발생시키기
     │   - Telegram 알림 수신 확인
     │   - 알림 내용 확인 (trace_id, 스택 트레이스)
     │
     ├─> 4. journald 통합 확인
     │   - journalctl -u hantu-scheduler -n 50
     │   - stderr 출력 확인
     │
     └─> 5. trace_id 전파 확인
         - 동일 요청에서 trace_id 일관성 확인
         - 로그 추적 가능 여부 확인
         │
         ▼
[완료 단계]
     │
     ├─> 1. 3일간 모니터링
     │   - 디스크 사용량 추이 확인
     │   - 로그 자동 삭제 확인 (3일 후)
     │   - DB 크기 증가율 확인
     │
     ├─> 2. 성능 확인
     │   - 로깅 오버헤드 측정
     │   - DB 배치 처리 지연시간 확인
     │
     └─> 3. 문서 업데이트
         - CLAUDE.md 업데이트
         - 운영 가이드 작성
         │
         ▼
    [마이그레이션 완료]
```

### 6.2 롤백 계획

```
[문제 발생 시]
     │
     ├─> 1. 즉시 중단
     │   - 서비스 중지
     │   - 문제 로그 수집
     │
     ├─> 2. 이전 버전으로 복원
     │   - git checkout [previous-commit]
     │   - systemctl restart hantu-*
     │
     ├─> 3. 백업 로그 복원 (선택)
     │   - logs_backup_YYYYMMDD/ → logs/
     │
     └─> 4. 원인 분석 후 재시도
```

### 6.3 마이그레이션 체크리스트

#### 준비 단계

- [ ] 기존 로그 백업 완료
- [ ] logs/ 디렉토리 정리 (기존 파일 삭제)
- [ ] logs/errors/, logs/info/ 디렉토리 생성
- [ ] DB error_logs 테이블 확인

#### 배포 단계

- [ ] 코드 업데이트 (git pull)
- [ ] 의존성 설치 확인
- [ ] systemd 서비스 재시작
- [ ] 서비스 상태 확인 (systemctl status)

#### 검증 단계

- [ ] INFO 로그 파일 생성 확인
- [ ] 에러 로그 JSON 포맷 확인
- [ ] DB error_logs INSERT 확인
- [ ] Telegram 알림 수신 확인
- [ ] journalctl 출력 확인
- [ ] trace_id 전파 확인

#### 운영 단계

- [ ] 3일간 모니터링 (자동 삭제 확인)
- [ ] 디스크 사용량 추이 확인
- [ ] DB 크기 증가율 확인
- [ ] 성능 영향 측정
- [ ] 문서 업데이트

---

## 7. 주요 경로 정의

### 7.1 파일 경로

| 유형             | 경로                              | 포맷   | 보관 기간      |
| ---------------- | --------------------------------- | ------ | -------------- |
| **일반 로그**    | `logs/info/info_YYYYMMDD.log`     | 텍스트 | 3일            |
| **에러 로그**    | `logs/errors/error_YYYYMMDD.json` | JSON   | 3일            |
| **DB 에러 로그** | `error_logs` 테이블               | SQL    | 무제한         |
| **systemd 로그** | journald                          | Binary | systemd 기본값 |

### 7.2 로그 포맷

#### 일반 로그 (텍스트)

```
2026-02-01 12:34:56 [INFO] core.trading.engine: 주문 실행 시작 (trace_id=abc12345)
2026-02-01 12:34:57 [WARNING] core.api.kis_api: API 재시도 (trace_id=abc12345)
```

#### 에러 로그 (JSON)

```json
{
  "timestamp": "2026-02-01T12:34:58",
  "trace_id": "abc12345",
  "level": "ERROR",
  "service": "scheduler",
  "module": "trading_engine",
  "function": "execute_order",
  "message": "주문 실행 실패: 잔고 부족",
  "error_type": "InsufficientBalance",
  "stack_trace": "Traceback (most recent call last):\n  File ...",
  "context": {
    "stock_code": "005930",
    "order_type": "buy",
    "quantity": 10
  }
}
```

#### Telegram 알림

```
🚨 [scheduler] 에러
2026-02-01 12:34:58 | trading_engine.execute_order
타입: InsufficientBalance

주문 실행 실패: 잔고 부족

```

File "core/trading/engine.py", line 123
raise InsufficientBalance()
InsufficientBalance

```
(trace_id: abc12345)
```

---

## 8. 이모티콘 사용 규칙

### 8.1 파일 로그 및 CLI

| 레벨        | 이모티콘 | 사용 위치                  |
| ----------- | -------- | -------------------------- |
| **SUCCESS** | ✅       | 로그 파일, CLI 출력        |
| **ERROR**   | ❌       | 로그 파일, CLI 출력        |
| **WARNING** | ⭕       | 로그 파일, CLI 출력        |
| **INFO**    | ℹ️       | CLI 출력만 (파일은 텍스트) |

예시:

```
# 로그 파일
2026-02-01 12:34:56 ✅ [INFO] 주문 체결 성공
2026-02-01 12:34:57 ❌ [ERROR] API 호출 실패
2026-02-01 12:34:58 ⭕ [WARNING] 잔고 부족

# CLI 출력
✅ 서비스 시작 완료
❌ 에러 발생: 연결 실패
ℹ️  로그 파일: logs/info/info_20260201.log
```

### 8.2 Telegram 알림

**현재 Telegram 알림 형식을 유지합니다.**

```
🚨 [서비스] 에러  (CRITICAL/ERROR)
⚠️ [서비스] 경고  (WARNING)
✅ [서비스] 성공  (배포 완료 등)
📊 [서비스] 리포트 (일일 보고서)
```

---

## 9. trace_id 전파 규칙

### 9.1 trace_id 생성 시점

| 진입점            | trace_id 생성 | 전파 방법  |
| ----------------- | ------------- | ---------- |
| **HTTP 요청**     | 요청 시작 시  | ContextVar |
| **스케줄러 작업** | 작업 시작 시  | ContextVar |
| **CLI 명령**      | 명령 실행 시  | ContextVar |
| **배치 작업**     | 배치 시작 시  | ContextVar |

### 9.2 trace_id 전파 예시

```python
# HTTP 요청
with TraceIdContext():  # trace_id 자동 생성
    logger.info("요청 시작")  # trace_id 자동 포함
    process_request()
    logger.info("요청 완료")  # 같은 trace_id

# 함수 간 전파
def parent_function():
    logger.info("부모 함수")  # trace_id=abc123
    child_function()         # trace_id=abc123 전파

def child_function():
    logger.info("자식 함수")  # trace_id=abc123 (자동 전파)
```

---

## 10. 고려사항

### 10.1 성능

- **로그 쓰기 지연**: 비동기 큐 사용으로 최소화
- **DB 배치**: 10개 또는 5초 간격으로 일괄 처리
- **디스크 I/O**: 텍스트 로그는 버퍼링, JSON은 즉시 쓰기

### 10.2 보안

- **민감 정보 마스킹**: SensitiveDataFilter 자동 적용
- **API 키/토큰**: 로그에 절대 노출 금지
- **개인 정보**: 계좌번호, 사용자 ID 마스킹

### 10.3 확장성

- **로그 볼륨 증가**: 로컬 파일 3일 자동 삭제로 관리
- **DB 크기**: 인덱스 최적화 (timestamp, service, level)
- **Telegram 제한**: 5분 쿨다운으로 스팸 방지

### 10.4 운영

- **로그 조회**: CLI 명령어 제공 예정 (`hantu logs error --tail`)
- **에러 집계**: DB 쿼리로 에러 통계 분석
- **알림 관리**: Telegram 쿨다운 시간 조정 가능

---

## 11. 다음 단계

### Planning 완료 후 위임

```
✅ 사용자 여정 설계 완료
   │
   ▼
→ Dev/plan-implementation
  (기술 구현 계획 수립)
```

### 전달 정보

- **여정 문서**: `docs/planning/user-journeys/logging-system-redesign.md`
- **핵심 플로우**: 로그 생성 → 핸들러 분기 → 저장 → 자동 삭제
- **주요 상태**: READY, 로그 처리 중, 배치 플러시, 종료
- **에러 처리**: 폴백 핸들러, 재시도 큐, Telegram 알림
- **미결정 사항 (P1/P2)**:
  - P1: CLI 명령어 상세 스펙 (`hantu logs` 기능)
  - P2: DB 에러 로그 보관 기간 정책 (무제한 vs 6개월)
  - P2: 로그 압축 정책 (백업 로그 압축 여부)

---

**작성일**: 2026-02-01
**작성자**: design-user-journey (Planning Agent)
**상태**: 완료 ✅
