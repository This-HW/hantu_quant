# Planning 협업 프로토콜

> 이 문서는 Planning과 Dev 간의 협업 규칙을 정의합니다.
> 모든 에이전트는 이 프로토콜을 준수해야 합니다.

---

## 핵심 원칙

### 1. 추측하지 않는다

```
❌ "아마 사용자는 ~를 원할 것이다"
❌ "보통 이런 경우는 ~한다"
❌ "~일 것 같다"

✅ "사용자가 명시한 요구사항은 ~이다"
✅ "확인이 필요합니다: ~"
✅ "기획 문서에 따르면 ~이다"
```

### 2. 모호함을 분류한다 (P0~P3)

| 등급 | 기준 | 예시 | 처리 |
|------|------|------|------|
| **P0** | 데이터 무결성, 보안, 금융, 핵심 비즈니스 | 결제 금액 계산, 권한 체계, 데이터 삭제 정책 | **즉시 중단 + 질문** |
| **P1** | UX 분기, 비즈니스 디테일 | 에러 메시지 문구, 정렬 순서, 페이지네이션 | 기본값 적용 + 나중에 확인 |
| **P2** | UI 디테일, 엣지케이스 | 버튼 색상, 애니메이션, 극단적 케이스 | TODO 기록 |
| **P3** | 기술 선택 | 라이브러리, 패턴, 구현 방식 | 자율 판단 |

### 3. Dev → Planning 역위임 프로토콜

Dev 에이전트가 구현 중 기획 모호함을 발견하면:

```
## 역위임 요청

**유형**: [P0_AMBIGUITY | MISSING_SPEC | INFEASIBLE]
**발생 위치**: [에이전트명, 작업 단계]
**컨텍스트**: [무엇을 하다가 발견했는가]
**구체적 질문**: [결정이 필요한 사항]
**제안 옵션**: [가능한 선택지들]
```

**처리 방식:**

| 유형 | 처리 |
|------|------|
| P0_AMBIGUITY | Planning으로 돌아가 AskUserQuestion 사용 |
| MISSING_SPEC | 해당 명세 추가 (여정/규칙) |
| INFEASIBLE | 대안 검토 → 사용자에게 보고 |

---

## 작업 규모 판단 기준

### 객관적 기준표

| 기준 | Small | Medium | Large |
|------|-------|--------|-------|
| **영향 범위** | 1개 모듈 내 | 2-3개 모듈 | 4개 이상 모듈 |
| **예상 파일 수** | 1-3개 | 4-10개 | 10개 이상 |
| **데이터 변경** | 없음 | 기존 구조 확장 | 새 구조 추가 |
| **비즈니스 규칙** | 기존 규칙 내 | 경미한 추가 | 핵심 규칙 변경 |
| **사용자 흐름** | 변경 없음 | 기존 흐름 수정 | 새 흐름 추가 |
| **예상 공수** | ~10시간 | 20-50시간 | 50시간+ |

### 규모별 필수 Planning 단계

```
Small:
  ✅ 요구사항 명확화
  ❌ 사용자 여정 설계 (생략)
  ❌ 비즈니스 로직 정의 (생략)

Medium:
  ✅ 요구사항 명확화
  ✅ 사용자 여정 설계
  ❌ 비즈니스 로직 정의 (생략 가능)

Large:
  ✅ 요구사항 명확화
  ✅ 사용자 여정 설계
  ✅ 비즈니스 로직 정의
```

---

## Planning 완료 조건

Planning이 완료되려면 다음 조건을 모두 만족해야 합니다:

### 필수 조건 (모든 규모)

```
□ P0 모호함 = 0개
□ 핵심 요구사항이 명확히 정의됨
□ 영향 범위가 식별됨
□ 리스크가 분석됨
```

### 추가 조건 (Medium 이상)

```
□ 사용자 여정이 정의됨
□ 주요 상태 전이가 명세됨
□ 에러 처리 전략이 수립됨
```

### 추가 조건 (Large)

```
□ 비즈니스 규칙이 명세됨
□ 규칙 간 관계가 정의됨
□ 예외 처리가 명세됨
```

---

## P0 질문 프로토콜

### P0 발견 시 행동

```
1. 즉시 구현 중단
2. 모호한 부분 명확히 정리
3. AskUserQuestion으로 사용자에게 질문
4. 답변 받은 후 기록
5. Planning 재진행
```

### 질문 형식

```
## 결정이 필요합니다

**맥락**: [어떤 상황에서 이 질문이 발생했는가]
**질문**: [구체적인 질문]
**옵션**:
1. [선택지 A] - [설명]
2. [선택지 B] - [설명]
3. [기타 의견]
```

### 답변 기록

```
## 결정 기록

**질문**: [질문 내용]
**답변**: [사용자 답변]
**결정일**: [날짜]
**영향**: [이 결정이 영향을 미치는 범위]
```

---

## 정보 전달 형식

### Planning → Dev 인수인계

```
# Planning 완료 보고서

## 1. 요구사항 요약
- 핵심 목표:
- 범위:
- 제약사항:

## 2. 확인된 사항
- [명확히 결정된 항목들]

## 3. 사용자 여정 (해당시)
- 진입점:
- 주요 흐름:
- 종료점:

## 4. 비즈니스 규칙 (해당시)
| ID | 유형 | 설명 |
|----|------|------|

## 5. 미결정 사항 (P1/P2)
- [나중에 결정할 항목들]

## 6. 구현 권장사항
- 시작점:
- 주의사항:
```

### Dev → Planning 역위임

```
# 역위임 요청

## 유형
[P0_AMBIGUITY | MISSING_SPEC | INFEASIBLE]

## 컨텍스트
- 작업: [무엇을 하고 있었는가]
- 단계: [어느 단계에서 발견했는가]
- 관련 파일: [관련 코드/문서]

## 발견한 문제
[구체적인 모호함/누락/불가능 사항]

## 제안 옵션
1. [옵션 A]
2. [옵션 B]

## 필요한 결정
[무엇이 결정되어야 진행 가능한가]
```

---

## 모호함 탐지 신호

다음 표현이 나타나면 모호함을 의심하세요:

### 위험 신호

```
- "~해야 할 것 같다" → 확인 필요
- "아마 ~일 것이다" → 확인 필요
- "보통은 ~한다" → 프로젝트 기준 확인
- "~가 좋을 것 같다" → 기획 확인
- "임시로 ~하고" → 기획 확인
```

### 안전 표현

```
- "기획에 따르면 ~이다" ✅
- "사용자가 요청한 ~을 구현한다" ✅
- "기존 패턴을 따라 ~한다" ✅
- "확인 결과 ~이다" ✅
```

---

## Claude Code 제약사항

### Subagent 제한

```
❌ Subagent가 다른 Subagent를 호출할 수 없음
❌ Subagent 간 직접 상태 공유 불가
❌ Subagent에 Task tool 포함 금지

✅ 메인 Claude가 순차적으로 Subagent 호출
✅ 파일/문서를 통한 간접 정보 전달
✅ CLAUDE.md를 통한 전역 컨텍스트 공유
```

### 올바른 협업 패턴

```
메인 Claude
    ├── Task(Explore) → 결과 수집
    ├── Task(general-purpose, 요구사항 분석) → 결과 수집
    ├── Task(general-purpose, 여정 설계) → 결과 수집
    ├── Task(general-purpose, 규칙 정의) → 결과 수집
    └── 종합하여 구현 계획 수립
```

---

## 체크리스트

### Planning 시작 전

```
□ 사용자 요청이 명확한가?
□ 작업 규모를 판단했는가?
□ 필요한 Planning 단계를 식별했는가?
```

### Planning 진행 중

```
□ P0 모호함을 발견하면 즉시 질문했는가?
□ 각 단계의 결과를 기록했는가?
□ 다음 단계에 필요한 정보를 전달했는가?
```

### Planning 완료 시

```
□ 모든 P0 모호함이 해결되었는가?
□ 인수인계 문서가 작성되었는가?
□ 미결정 사항(P1/P2)이 기록되었는가?
□ Dev가 시작할 준비가 되었는가?
```
