---
name: monitor
description: 시스템 모니터링. 현재 상태를 확인하고 이상 징후를 탐지합니다.
argument-hint: [대상: app, infra, db, 또는 빈칸=전체]
allowed-tools: Read, Bash, Glob, Grep, Task
---

# 시스템 모니터링 실행

**즉시 실행하세요. 설명하지 말고 바로 실행합니다.**

대상: $ARGUMENTS (없으면 전체)

---

## 파이프라인 구조

```
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│ monitor      │ → │ diagnose     │ → │ respond-     │
│ (haiku)      │   │ (opus)       │   │ incident     │
└──────────────┘   └──────────────┘   └──────────────┘
       │                 │                   │
       ▼                 ▼                   ▼
  상태 확인        이상 시 분석       위험 시 대응
```

---

## 1단계: 시스템 모니터링

```
Task tool 사용:
subagent_type: monitor
model: haiku
prompt: |
  시스템 상태를 확인해주세요.
  대상: $ARGUMENTS (없으면 전체)

  ### 서비스 상태
  - systemd 서비스 상태
  - Docker 컨테이너 상태
  - 프로세스 상태

  ### 리소스 사용량
  - CPU/메모리
  - 디스크
  - 네트워크

  ### 로그 확인
  - 최근 에러 로그
  - 애플리케이션 로그
```

---

## 2단계: 이상 징후 발견 시 진단

경고 또는 위험 상태 발견 시:

```
Task tool 사용:
subagent_type: diagnose
model: opus
prompt: |
  [모니터링 결과 포함]

  이상 징후의 원인을 진단해주세요:
  - 근본 원인 분석
  - 영향 범위 파악
  - 대응 방안 제안
```

---

## 3단계: 위험 시 인시던트 대응

위험 상태 발견 시:

```
Task tool 사용:
subagent_type: respond-incident
model: sonnet
prompt: |
  [진단 결과 포함]

  즉각 대응이 필요합니다:
  - 심각도 판단
  - 즉각 조치 실행
  - 필요 시 롤백 준비
```

---

## 상태 판정 기준

| 메트릭     | 정상 | 경고   | 위험 |
| ---------- | ---- | ------ | ---- |
| CPU        | <70% | 70-90% | >90% |
| Memory     | <70% | 70-90% | >90% |
| Disk       | <80% | 80-95% | >95% |
| Error Rate | <1%  | 1-5%   | >5%  |

---

## 출력 형식

### 시스템 상태: [🟢 정상 / 🟡 경고 / 🔴 위험]

### 리소스 현황

| 메트릭 | 현재 | 기준 | 상태       |
| ------ | ---- | ---- | ---------- |
| CPU    | [N%] | <70% | [🟢/🟡/🔴] |
| Memory | [N%] | <70% | [🟢/🟡/🔴] |
| Disk   | [N%] | <80% | [🟢/🟡/🔴] |

### 서비스 상태

[서비스별 상태]

### 최근 이슈

[에러 로그 요약 또는 "없음"]

### 권장 조치

[필요한 조치 또는 "없음"]
