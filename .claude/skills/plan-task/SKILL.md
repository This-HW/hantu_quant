---
name: plan-task
description: 체계적인 작업 계획 수립. 규모 판단 → 요구사항 명확화 → 사용자 여정 → 비즈니스 로직 순으로 진행합니다.
argument-hint: [작업 설명]
allowed-tools: Read, Glob, Grep, Task, TodoWrite, AskUserQuestion
---

# 작업 계획 수립

**즉시 실행하세요. 설명하지 말고 바로 실행합니다.**

사용자 요청: $ARGUMENTS

---

## 파이프라인 구조

```
┌──────────────┐   ┌───────────────────┐   ┌───────────────────┐
│ Phase 1      │ → │ Phase 2           │ → │ Phase 3           │
│ explore-     │   │ clarify-          │   │ design-user-      │
│ codebase     │   │ requirements      │   │ journey           │
│ (haiku)      │   │ (opus)            │   │ (sonnet)          │
└──────────────┘   └───────────────────┘   └───────────────────┘
                                                    │
                   ┌───────────────────┐            │
                   │ Phase 4           │ ←──────────┘
                   │ define-business-  │
                   │ logic (sonnet)    │
                   └───────────────────┘
                            │
                   ┌───────────────────┐
                   │ Phase 5           │
                   │ plan-             │
                   │ implementation    │
                   │ (haiku)           │
                   └───────────────────┘
```

**중요**: Subagent는 다른 subagent를 호출할 수 없으므로 Main Claude가 순차적으로 오케스트레이션합니다.

---

## Phase 0: 규모 판단 (즉시 실행)

다음 기준으로 작업 규모를 판단하세요:

| 기준          | Small        | Medium         | Large          |
| ------------- | ------------ | -------------- | -------------- |
| 영향 범위     | 1개 모듈     | 2-3개 모듈     | 4개+ 모듈      |
| 데이터 변경   | 없음         | 기존 구조 확장 | 새 구조 추가   |
| 비즈니스 규칙 | 기존 규칙 내 | 경미한 추가    | 핵심 규칙 변경 |
| 사용자 흐름   | 변경 없음    | 기존 흐름 수정 | 새 흐름 추가   |

### 규모별 Planning 경로

```
Small:  Phase 1 → Phase 2 → Phase 5 → 완료
Medium: Phase 1 → Phase 2 → Phase 3 → Phase 5 → 완료
Large:  Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5 → 완료
```

**출력:**

```
## 규모 판단

- **규모**: [Small/Medium/Large]
- **근거**: [판단 이유]
- **Planning 경로**: [거칠 Phase 목록]
```

---

## Phase 1: 코드베이스 탐색 (필수)

```
Task tool 사용:
subagent_type: explore-codebase
model: haiku
prompt: |
  요청: [사용자 요청]

  다음을 파악해주세요:
  1. 프로젝트 구조 및 기술 스택
  2. 관련 파일 및 의존성
  3. 기존 코드 패턴과 컨벤션
  4. 수정이 필요한 위치
  5. 유사한 기존 구현 (참고용)
```

---

## Phase 2: 요구사항 명확화 (필수)

```
Task tool 사용:
subagent_type: clarify-requirements
model: opus
prompt: |
  [사용자 요청]
  [Phase 1 탐색 결과]

  다음을 수행하세요:

  ### 1. 요구사항 분석
  - 명시적 요구사항 (사용자가 직접 언급)
  - 암묵적 요구사항 (맥락에서 추론)
  - 기술적 제약사항

  ### 2. 모호함 분류 (P0~P3)

  | 등급 | 기준 | 처리 |
  |------|------|------|
  | P0 | 데이터 무결성, 보안, 금융, 핵심 비즈니스 | 즉시 질문 |
  | P1 | UX 분기, 비즈니스 디테일 | 기본값 + 나중에 확인 |
  | P2 | UI 디테일, 엣지케이스 | TODO로 기록 |
  | P3 | 기술 선택 | 자율 판단 |

  ### 3. P0 모호함 발견 시
  - 구체적인 질문 형식으로 정리
  - "결정이 필요합니다: [질문]"

  출력 형식:
  ## 요구사항 요약
  [핵심 요구사항]

  ## 확인된 사항
  [명확한 부분]

  ## P0 모호함 (있는 경우)
  [즉시 확인 필요한 사항]

  ## P1/P2 미결정 사항
  [나중에 결정할 항목]
```

**P0 모호함 발견 시:**

- AskUserQuestion으로 사용자에게 질문
- 답변 받은 후 clarify-requirements 재호출

---

## Phase 3: 사용자 여정 설계 (Medium/Large)

```
Task tool 사용:
subagent_type: design-user-journey
model: sonnet
prompt: |
  [사용자 요청]
  [Phase 2 요구사항 결과]

  다음을 수행하세요:

  ### 1. 사용자 여정 정의
  - 진입점: 사용자가 이 기능에 어떻게 접근?
  - 주요 흐름: 성공 시나리오
  - 대안 흐름: 분기 상황
  - 종료점: 완료 상태

  ### 2. 상태 다이어그램
```

[초기] → [로딩] → [성공/실패]
↓
[에러 처리]

```

### 3. 에러 처리 전략
| 에러 유형 | 처리 방법 |
|----------|----------|
| 네트워크 | 재시도 UI |
| 권한 | 권한 요청 안내 |
| 데이터 | 사용자 피드백 |
| 입력 | 실시간 유효성 검사 |

출력 형식:
## 사용자 여정
[흐름 설명]

## 상태 다이어그램
[상태 전이]

## 에러 처리 전략
[에러별 처리]
```

---

## Phase 4: 비즈니스 로직 정의 (Large)

```
Task tool 사용:
subagent_type: define-business-logic
model: sonnet
prompt: |
  [사용자 요청]
  [Phase 2 요구사항]
  [Phase 3 사용자 여정]

  다음을 수행하세요:

  ### 1. 비즈니스 규칙 식별
  - VAL: 유효성 검증 규칙
  - CALC: 계산 규칙
  - STATE: 상태 전이 규칙
  - AUTH: 권한 규칙
  - POL: 정책 규칙

  ### 2. 규칙 명세화
  각 규칙에 대해:
  - 규칙 ID
  - 조건
  - 결과
  - 예외
  - 예시

  출력 형식:
  ## 비즈니스 규칙 목록
  | ID | 유형 | 설명 |
  |----|------|------|

  ## 규칙 상세
  ### [규칙 ID]
  - 조건: ...
  - 결과: ...
  - 예외: ...
  - 예시: ...
```

---

## Phase 5: 구현 계획 수립 (필수)

```
Task tool 사용:
subagent_type: plan-implementation
model: haiku
prompt: |
  [사용자 요청]
  [Phase 2 요구사항]
  [Phase 3 사용자 여정 - 해당시]
  [Phase 4 비즈니스 규칙 - 해당시]

  다음 구현 계획을 수립해주세요:

  ### 목표
  [요구사항 요약]

  ### 기술적 결정
  [선택한 접근 방식과 이유]

  ### 작업 분해
  배치 1 (병렬 가능):
    - [ ] 작업 1.1: [설명]
    - [ ] 작업 1.2: [설명]

  배치 2 (배치1 완료 후):
    - [ ] 작업 2.1: [설명]

  ### 파일 변경 예상
  | 파일 | 변경 내용 |
  |------|----------|
  | path/to/file | 추가/수정/삭제 내용 |

  ### 리스크
  | 리스크 | 대응책 |
  |--------|--------|
  | [예상 문제] | [해결 방법] |
```

---

## Planning 완료 체크리스트

```
□ 규모 판단 완료
□ P0 모호함 모두 해결
□ 요구사항 명확히 정의됨
□ 사용자 여정 설계됨 (Medium/Large)
□ 비즈니스 규칙 명세됨 (Large)
□ 구현 계획 수립됨
□ 리스크 식별됨
```

---

## 출력 형식

```
# Planning 완료 보고서

## 1. 규모 및 경로
- 규모: [Small/Medium/Large]
- 거친 Phase: [목록]

## 2. 요구사항 요약
[Phase 2 결과]

## 3. 사용자 여정 (해당시)
[Phase 3 결과]

## 4. 비즈니스 규칙 (해당시)
[Phase 4 결과]

## 5. 구현 계획
[Phase 5 결과]

## 6. 미결정 사항 (P1/P2)
[나중에 결정할 항목]

## 7. 다음 단계
- 구현 시작: `/auto-dev [작업]`
- 또는 "진행해줘"라고 요청
```
